<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <base href="/">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <script src="//connect.facebook.net/es_LA/sdk.js"></script>
     <link rel="stylesheet" href="assets/css/style.css">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css(client) app/vendor.css -->
      <!-- bower:css -->
      <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
      <link rel="stylesheet" href="bower_components/Hover/css/hover.css" />
      <link rel="stylesheet" href="bower_components/angular-bootstrap-colorpicker/css/colorpicker.css" />
      <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css({.tmp,client}) app/app.css -->
    <link rel="stylesheet" href="app/app.css">
      <!-- injector:css -->
      <link rel="stylesheet" href="app/account/login/login.css">
      <link rel="stylesheet" href="app/admin/admin.css">
      <link rel="stylesheet" href="app/app.css">
      <link rel="stylesheet" href="app/main/main.css">
      <link rel="stylesheet" href="components/modal/modal.css">
      <!-- endinjector -->
    <!-- endbuild -->
  </head>
  <body ng-app="alianzaImagineApp">
    <img src="../../assets/images/backface.jpg" class="bg">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <!-- Add your site or application content here -->
    <div ui-view=""></div>
    <script>
     if ( XMLHttpRequest.prototype.sendAsBinary === undefined ) {
                  XMLHttpRequest.prototype.sendAsBinary = function(string) {
                      var bytes = Array.prototype.map.call(string, function(c) {
                          return c.charCodeAt(0) & 0xff;
                      });
                      this.send(new Uint8Array(bytes).buffer);
                  };
              };

       var Base64Binary = {
                _keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",                
                /* will return a  Uint8Array type */
                decodeArrayBuffer: function(input) {
                  var bytes = (input.length/4) * 3;
                  var ab = new ArrayBuffer(bytes);
                  this.decode(input, ab);
                  
                  return ab;
                },
                
                decode: function(input, arrayBuffer) {
                  //get last chars to see if are valid
                  var lkey1 = this._keyStr.indexOf(input.charAt(input.length-1));    
                  var lkey2 = this._keyStr.indexOf(input.charAt(input.length-2));    
                
                  var bytes = (input.length/4) * 3;
                  if (lkey1 == 64) bytes--; //padding chars, so skip
                  if (lkey2 == 64) bytes--; //padding chars, so skip
                  
                  var uarray;
                  var chr1, chr2, chr3;
                  var enc1, enc2, enc3, enc4;
                  var i = 0;
                  var j = 0;
                  
                  if (arrayBuffer)
                    uarray = new Uint8Array(arrayBuffer);
                  else
                    uarray = new Uint8Array(bytes);
                  
                  input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
                  
                  for (i=0; i<bytes; i+=3) {  
                    //get the 3 octects in 4 ascii chars
                    enc1 = this._keyStr.indexOf(input.charAt(j++));
                    enc2 = this._keyStr.indexOf(input.charAt(j++));
                    enc3 = this._keyStr.indexOf(input.charAt(j++));
                    enc4 = this._keyStr.indexOf(input.charAt(j++));
                
                    chr1 = (enc1 << 2) | (enc2 >> 4);
                    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                    chr3 = ((enc3 & 3) << 6) | enc4;
                
                    uarray[i] = chr1;     
                    if (enc3 != 64) uarray[i+1] = chr2;
                    if (enc4 != 64) uarray[i+2] = chr3;
                  }
                
                  return uarray;  
                }
              }

        function postCanvasToFacebook() {           
              
          var canvas = document.getElementById('tempCanvas');
          //var data = canvas.toDataURL("image/png");
          var data = canvas.toDataURL("image/jpeg", 1);
          var encodedPng = data.substring(data.indexOf(',') + 1, data.length);
          var decodedPng = Base64Binary.decode(encodedPng);  

          FB.api('/'+id+'/permissions/publish_actions', function(resp) {
            console.log('Id:'+id);
            console.log("Response Permissions");
            console.log(resp);
                if (resp.data[0].status === "declined") {
                    (function( $ ){$(document).ready(function(){   
                       angular.element('#abc').scope().open_dialog('Lo Sentimos, para Compartir Primero Debes Aceptar Los Permisos de Publicacion','glyphicon-thumbs-down');
                       angular.element('#abc').scope().$apply();  
                     });})( jQuery );
                     FB.login(function(response) {
                         console.log("Tercer Logeeo");
                         }, {
                           scope: 'publish_actions', 
                           return_scopes: true
                         });

                } else {
                   postImageToFacebook(token, "reconexion2015", "image/jpeg", decodedPng, "Yo ya cree mi propia #ReDefinicion de #Reconexion, Que esperas para crear la tuya? Usa tu imaginacion y juntos intensifiquemos el mensaje de verdad.");
                   angular.element('#abc').scope().open_dialog('!Exito al Compartir Tu Imagen de ReConexion 2015! Vistia tu Perfil','glyphicon-thumbs-up');
                   angular.element('#abc').scope().$apply();
                }
            });    

        };

        function postImageToFacebook( authToken, filename, mimeType, imageData, message ){
            // this is the multipart/form-data boundary we'll use
            var boundary = '----ThisIsTheBoundary1234567890';   
            // let's encode our image file, which is contained in the var
            var formData = '--' + boundary + '\r\n'
            formData += 'Content-Disposition: form-data; name="source"; filename="' + filename + '"\r\n';
            formData += 'Content-Type: ' + mimeType + '\r\n\r\n';
            for ( var i = 0; i < imageData.length; ++i )
            {
                formData += String.fromCharCode( imageData[ i ] & 0xff );
            }
            formData += '\r\n';
            formData += '--' + boundary + '\r\n';
            formData += 'Content-Disposition: form-data; name="message"\r\n\r\n';
            formData += message + '\r\n'
            formData += '--' + boundary + '--\r\n';
            
            var xhr = new XMLHttpRequest();
            xhr.open( 'POST', 'https://graph.facebook.com/me/photos?access_token=' + authToken, true );
            xhr.onload = xhr.onerror = function() {
                console.log( xhr.responseText );
            };
            xhr.setRequestHeader( "Content-Type", "multipart/form-data; boundary=" + boundary );
            xhr.sendAsBinary( formData );
        };
    </script>      
    <!--[if lt IE 9]>
    <script src="bower_components/es5-shim/es5-shim.js"></script>
    <script src="bower_components/json3/lib/json3.min.js"></script>
    <![endif]-->
    <!-- build:js({client,node_modules}) app/vendor.js -->
      <!-- bower:js -->
      <script src="bower_components/jquery/dist/jquery.js"></script>
      <script src="bower_components/angular/angular.js"></script>
      <script src="bower_components/angular-resource/angular-resource.js"></script>
      <script src="bower_components/angular-cookies/angular-cookies.js"></script>
      <script src="bower_components/angular-sanitize/angular-sanitize.js"></script>
      <script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script>
      <script src="bower_components/lodash/dist/lodash.compat.js"></script>
      <script src="bower_components/angular-ui-router/release/angular-ui-router.js"></script>
      <script src="bower_components/lazy-line-painter/jquery.lazylinepainter-1.5.1.js"></script>
      <script src="bower_components/ng-facebook/ngFacebook.js"></script>
      <script src="bower_components/angular-animate/angular-animate.js"></script>
      <script src="bower_components/angular-audio/app/angular.audio.js"></script>
      <script src="bower_components/angular-bootstrap-colorpicker/js/bootstrap-colorpicker-module.js"></script>
      <!-- endbower -->
    <!-- endbuild -->
    <script>  
     var token; 
     var id;   
         function login(callback) {
          //FB.login(callback);
          console.log('Login');
          FB.login(callback);
        }
        function loginCallback(response) {
          console.log('loginCallback',response);
          if(response.status != 'connected') {
            top.location.href = 'https://www.facebook.com/appcenter/YOUR_APP_NAMESPACE';
          }else{
            token=response.authResponse.accessToken;
            id=response.authResponse.userID;
            console.log('loginCallback If Cubo');            
            iniciarCubo();          
          }
        }
        function onStatusChange(response) {
          console.log('onStatusChange',response);
          if( response.status != 'connected' ) {
            login(loginCallback);
          } else {
            token=response.authResponse.accessToken;
            id=response.authResponse.userID;
            console.log('onStatusChange If Cubo');
            iniciarCubo();           
          }
        }

       /* function onAuthResponseChange(response) {
          console.log('onAuthResponseChange', response);
        }*/

        function iniciarCubo(){

          console.log('Cubo Iniciando...');

             var svgData = {
            "front" :
            {
              "strokepath" :
              [
                {
                    "path": "M 3 331.809 L 3 0.00001",
                    "duration": 4000
                },
                {
                    "path": "M 328 -0.99999 L 330 332.809",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 330.19101 L 328.90448 329.19101",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 2.19101 L 325.90448 3.19101",
                    "duration": 4000
               }
              ],
              "dimensions" : { "width": 331, "height":331 }
            }
          };

           var svgDataTop = {
            "top" :
            {
              "strokepath" :
              [
                {
                    "path": "M 3 331.809 L 3 0.00001",
                    "duration": 4000
                },
                {
                    "path": "M 328 -0.99999 L 330 332.809",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 330.19101 L 328.90448 329.19101",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 2.19101 L 325.90448 3.19101",
                    "duration": 4000
               }
              ],
              "dimensions" : { "width": 331, "height":331 }
            }
          };

           var svgDataLeft = {
            "left" :
            {
              "strokepath" :
              [
                {
                    "path": "M 3 331.809 L 3 0.00001",
                    "duration": 4000
                },
                {
                    "path": "M 328 -0.99999 L 330 332.809",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 330.19101 L 328.90448 329.19101",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 2.19101 L 325.90448 3.19101",
                    "duration": 4000
               }
              ],
              "dimensions" : { "width": 331, "height":331 }
            }
          };

           var svgDataRight = {
            "right" :
            {
              "strokepath" :
              [
                {
                    "path": "M 3 331.809 L 3 0.00001",
                    "duration": 4000
                },
                {
                    "path": "M 328 -0.99999 L 330 332.809",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 330.19101 L 328.90448 329.19101",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 2.19101 L 325.90448 3.19101",
                    "duration": 4000
               }
              ],
              "dimensions" : { "width": 331, "height":331 }
            }
          };

           var svgDataBack = {
            "back" :
            {
              "strokepath" :
              [
                {
                    "path": "M 3 331.809 L 3 0.00001",
                    "duration": 4000
                },
                {
                    "path": "M 328 -0.99999 L 330 332.809",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 330.19101 L 328.90448 329.19101",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 2.19101 L 325.90448 3.19101",
                    "duration": 4000
               }
              ],
              "dimensions" : { "width": 331, "height":331 }
            }
          };

           var svgDataBottom = {
            "bottom" :
            {
              "strokepath" :
              [
                {
                    "path": "M 3 331.809 L 3 0.00001",
                    "duration": 4000
                },
                {
                    "path": "M 328 -0.99999 L 330 332.809",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 330.19101 L 328.90448 329.19101",
                    "duration": 4000
                },
                {
                    "path": "M 3.90448 2.19101 L 325.90448 3.19101",
                    "duration": 4000
               }
              ],
              "dimensions" : { "width": 331, "height":331 }
            }
          };     
                console.log('Cubo Iniciando... Paso 2');
                 (function( $ ){$(document).ready(function(){   
                    window.onload = function(){
                      angular.element('#abc').scope().inicioSound();
                      angular.element('#abc').scope().$apply(); 
                     }                     
                 });})( jQuery );
               
                $('#abc').show();    

                 $('#front').lazylinepainter({
                    'svgData' : svgData,
                    'strokeWidth':7,
                    'strokeColor':'#4C0255'
                  });
                var state = 'paint';
                $('#front').lazylinepainter(state);             

                $('#top').lazylinepainter({
                  'svgData' : svgDataTop,
                  'strokeWidth':7,
                  'strokeColor':'#4C0255'
                });
              var state = 'paint';
               $('#top').lazylinepainter(state);
                $('#left').lazylinepainter({
                  'svgData' : svgDataLeft,
                  'strokeWidth':7,
                  'strokeColor':'#4C0255'
                });
              var state = 'paint';
               $('#left').lazylinepainter(state);


               $('#right').lazylinepainter({
                  'svgData' : svgDataRight,
                  'strokeWidth':7,
                  'strokeColor':'#4C0255'
                });
              var state = 'paint';
               $('#right').lazylinepainter(state);


               $('#back').lazylinepainter({
                  'svgData' : svgDataBack,
                  'strokeWidth':7,
                  'strokeColor':'#4C0255'              
                });
              var state = 'paint';
               $('#back').lazylinepainter(state);

               $('#bottom').lazylinepainter({
                  'svgData' : svgDataBottom,
                  'strokeWidth':7,
                  'strokeColor':'#4C0255',
                  'onComplete' : function(){
                   // $("#front_content").show();// se le puede poner un pequeño delay
                   
                   // setTimeout(function(){
                      //$('figure').css('background-color',' #64a43a');
                      //$('figure').css('border',' solid 2px white');
                      $('.tales').css('opacity',1);
                           //erase
                       $('#bottom').lazylinepainter('erase');  
                       $('#right').lazylinepainter('erase');
                       $('#front').lazylinepainter('erase');    
                       $('#top').lazylinepainter('erase');    
                       $('#back').lazylinepainter('erase'); 
                       $('#left').lazylinepainter('erase');    

                       $("#bini").show();
                       $("#rini").show();
                       $("#lini").show();
                       $("#baini").show();
                       $("#inicial_buttons").fadeIn();

                      angular.element('#abc').scope().initialShow();
                      angular.element('#abc').scope().$apply();  


                      FB.login(function(response) {
                           console.log("Segundo Logeeo");
                           }, {
                             scope: 'publish_actions', 
                             return_scopes: true
                           });
                    //  }, 1000);                 
                  }
                });
              var state = 'paint';
               $('#bottom').lazylinepainter(state); 
          }
  </script>
    <!-- build:js({.tmp,client}) app/app.js -->
    <script src="app/app.js"></script>
      <!-- injector:js -->
      <script src="app/account/account.js"></script>
      <script src="app/account/login/login.controller.js"></script>
      <script src="app/account/settings/settings.controller.js"></script>
      <script src="app/account/signup/signup.controller.js"></script>
      <script src="app/admin/admin.controller.js"></script>
      <script src="app/admin/admin.js"></script>
      <script src="app/main/main.controller.js"></script>
      <script src="app/main/main.js"></script>
      <script src="components/auth/auth.service.js"></script>
      <script src="components/auth/user.service.js"></script>
      <script src="components/modal/modal.service.js"></script>
      <script src="components/mongoose-error/mongoose-error.directive.js"></script>
      <script src="components/navbar/navbar.controller.js"></script>
      <!-- endinjector -->
    <!-- endbuild -->
</body>
</html>
